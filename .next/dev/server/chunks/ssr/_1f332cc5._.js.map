{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/lib/supabase/server.ts"],"sourcesContent":["// lib/supabase/server.ts\nimport \"server-only\";\nimport { cookies } from \"next/headers\";\nimport { createServerClient } from \"@supabase/ssr\";\n\nfunction mustGetEnv(name: string, value: string | undefined) {\n    const v = (value ?? \"\").trim();\n    if (!v) {\n        throw new Error(\n            `[supabaseServer] Missing env: ${name}. ` +\n            `Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY (or SUPABASE_URL / SUPABASE_ANON_KEY) in .env.local`\n        );\n    }\n    return v;\n}\n\nconst url =\n    process.env.NEXT_PUBLIC_SUPABASE_URL ??\n    process.env.SUPABASE_URL;\n\nconst anon =\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ??\n    process.env.SUPABASE_ANON_KEY;\n\n/**\n * Server Components / Server Actions / Route Handlers から使える Supabase client\n * - Server Component では cookie の set が禁止 → setAll を try/catch で無視して落ちないようにする\n * - Server Action / Route Handler では cookie set が許可 → 普通に更新される\n */\nexport async function supabaseServer() {\n    // Next の cookies() が sync/async どっちでも落ちないように吸収\n    const maybe = cookies() as any;\n    const cookieStore = typeof maybe?.then === \"function\" ? await maybe : maybe;\n\n    return createServerClient(\n        mustGetEnv(\"SUPABASE_URL / NEXT_PUBLIC_SUPABASE_URL\", url),\n        mustGetEnv(\"SUPABASE_ANON_KEY / NEXT_PUBLIC_SUPABASE_ANON_KEY\", anon),\n        {\n            cookies: {\n                getAll() {\n                    return cookieStore.getAll();\n                },\n                setAll(cookiesToSet) {\n                    // ここが今回のクラッシュ原因。Server Component だと cookieStore.set が例外になる\n                    try {\n                        cookiesToSet.forEach(({ name, value, options }: any) => {\n                            try {\n                                cookieStore.set(name, value, options);\n                            } catch {\n                                // Server Component から呼ばれた場合は無視（Next仕様）\n                            }\n                        });\n                    } catch {\n                        // 念のため全体も握る\n                    }\n                },\n            },\n        }\n    );\n}\n"],"names":[],"mappings":";;;;AAAA,yBAAyB;AACzB;AACA;AACA;AAAA;;;;AAEA,SAAS,WAAW,IAAY,EAAE,KAAyB;IACvD,MAAM,IAAI,CAAC,SAAS,EAAE,EAAE,IAAI;IAC5B,IAAI,CAAC,GAAG;QACJ,MAAM,IAAI,MACN,CAAC,8BAA8B,EAAE,KAAK,EAAE,CAAC,GACzC,CAAC,kHAAkH,CAAC;IAE5H;IACA,OAAO;AACX;AAEA,MAAM,MACF,gFACA,QAAQ,GAAG,CAAC,YAAY;AAE5B,MAAM,OACF,wPACA,QAAQ,GAAG,CAAC,iBAAiB;AAO1B,eAAe;IAClB,+CAA+C;IAC/C,MAAM,QAAQ,IAAA,0IAAO;IACrB,MAAM,cAAc,OAAO,OAAO,SAAS,aAAa,MAAM,QAAQ;IAEtE,OAAO,IAAA,+LAAkB,EACrB,WAAW,2CAA2C,MACtD,WAAW,qDAAqD,OAChE;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,2DAA2D;gBAC3D,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAO;wBAC/C,IAAI;4BACA,YAAY,GAAG,CAAC,MAAM,OAAO;wBACjC,EAAE,OAAM;wBACJ,uCAAuC;wBAC3C;oBACJ;gBACJ,EAAE,OAAM;gBACJ,YAAY;gBAChB;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/app/login/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { redirect } from \"next/navigation\";\nimport { supabaseServer } from \"@/lib/supabase/server\";\n\ntype AuthState = { ok: boolean; error: string | null; message?: string | null };\n\nfunction cleanNext(next: string | null | undefined) {\n    const n = (next ?? \"\").trim();\n    if (!n) return \"/drops\";\n    if (!n.startsWith(\"/\")) return \"/drops\";\n    return n;\n}\n\nexport async function authAction(_prev: AuthState, formData: FormData): Promise<AuthState> {\n    const mode = String(formData.get(\"mode\") ?? \"signin\");\n    const email = String(formData.get(\"email\") ?? \"\").trim();\n    const password = String(formData.get(\"password\") ?? \"\").trim();\n    const next = cleanNext(String(formData.get(\"next\") ?? \"\"));\n\n    if (!email || !password) return { ok: false, error: \"email / password を入力して。\" };\n\n    const supabase = await supabaseServer();\n\n    if (mode === \"signup\") {\n        const { data, error } = await supabase.auth.signUp({ email, password });\n        if (error) return { ok: false, error: error.message };\n\n        // email confirm がONだと session が無いことがある\n        if (!data.session) {\n            return { ok: true, error: null, message: \"確認メールを送った。メールを確認してログインして。\" };\n        }\n\n        redirect(next);\n    }\n\n    // signin\n    const { error } = await supabase.auth.signInWithPassword({ email, password });\n    if (error) return { ok: false, error: error.message };\n\n    redirect(next);\n}\n\nexport async function logoutAction(): Promise<void> {\n    const supabase = await supabaseServer();\n    await supabase.auth.signOut();\n    redirect(\"/login\");\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAAA;AACA;;;;;AAIA,SAAS,UAAU,IAA+B;IAC9C,MAAM,IAAI,CAAC,QAAQ,EAAE,EAAE,IAAI;IAC3B,IAAI,CAAC,GAAG,OAAO;IACf,IAAI,CAAC,EAAE,UAAU,CAAC,MAAM,OAAO;IAC/B,OAAO;AACX;AAEO,eAAe,WAAW,KAAgB,EAAE,QAAkB;IACjE,MAAM,OAAO,OAAO,SAAS,GAAG,CAAC,WAAW;IAC5C,MAAM,QAAQ,OAAO,SAAS,GAAG,CAAC,YAAY,IAAI,IAAI;IACtD,MAAM,WAAW,OAAO,SAAS,GAAG,CAAC,eAAe,IAAI,IAAI;IAC5D,MAAM,OAAO,UAAU,OAAO,SAAS,GAAG,CAAC,WAAW;IAEtD,IAAI,CAAC,SAAS,CAAC,UAAU,OAAO;QAAE,IAAI;QAAO,OAAO;IAA0B;IAE9E,MAAM,WAAW,MAAM,IAAA,2IAAc;IAErC,IAAI,SAAS,UAAU;QACnB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;YAAE;YAAO;QAAS;QACrE,IAAI,OAAO,OAAO;YAAE,IAAI;YAAO,OAAO,MAAM,OAAO;QAAC;QAEpD,uCAAuC;QACvC,IAAI,CAAC,KAAK,OAAO,EAAE;YACf,OAAO;gBAAE,IAAI;gBAAM,OAAO;gBAAM,SAAS;YAA4B;QACzE;QAEA,IAAA,iMAAQ,EAAC;IACb;IAEA,SAAS;IACT,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;QAAE;QAAO;IAAS;IAC3E,IAAI,OAAO,OAAO;QAAE,IAAI;QAAO,OAAO,MAAM,OAAO;IAAC;IAEpD,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,WAAW,MAAM,IAAA,2IAAc;IACrC,MAAM,SAAS,IAAI,CAAC,OAAO;IAC3B,IAAA,iMAAQ,EAAC;AACb;;;IAjCsB;IA6BA;;AA7BA,+OAAA;AA6BA,+OAAA"}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/app/components/LogoutButton.tsx"],"sourcesContent":["import { logoutAction } from \"@/app/login/actions\";\n\nexport default function LogoutButton() {\n    return (\n        <form action={logoutAction}>\n            <button\n                type=\"submit\"\n                style={{\n                    padding: \"8px 10px\",\n                    borderRadius: 10,\n                    border: \"1px solid #d1d5db\",\n                    background: \"transparent\",\n                    fontWeight: 900,\n                    cursor: \"pointer\",\n                }}\n            >\n                Logout\n            </button>\n        </form>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;AAEe,SAAS;IACpB,qBACI,8OAAC;QAAK,QAAQ,uIAAY;kBACtB,cAAA,8OAAC;YACG,MAAK;YACL,OAAO;gBACH,SAAS;gBACT,cAAc;gBACd,QAAQ;gBACR,YAAY;gBACZ,YAAY;gBACZ,QAAQ;YACZ;sBACH;;;;;;;;;;;AAKb"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACxB"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n    \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-semibold transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-900 disabled:pointer-events-none disabled:opacity-50\",\n    {\n        variants: {\n            variant: {\n                default: \"bg-zinc-900 text-white hover:bg-zinc-800\",\n                outline: \"border border-zinc-200 bg-white hover:bg-zinc-50\",\n                ghost: \"hover:bg-zinc-100\",\n                destructive: \"bg-red-600 text-white hover:bg-red-500\",\n            },\n            size: {\n                default: \"h-10 px-4\",\n                sm: \"h-9 px-3\",\n                lg: \"h-11 px-5\",\n            },\n        },\n        defaultVariants: { variant: \"default\", size: \"default\" },\n    }\n);\n\nexport interface ButtonProps\n    extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n    asChild?: boolean;\n}\n\nexport function Button({ className, variant, size, asChild, ...props }: ButtonProps) {\n    const Comp: any = asChild ? Slot : \"button\";\n    return <Comp className={cn(buttonVariants({ variant, size, className }))} {...props} />;\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACtB,iOACA;IACI,UAAU;QACN,SAAS;YACL,SAAS;YACT,SAAS;YACT,OAAO;YACP,aAAa;QACjB;QACA,MAAM;YACF,SAAS;YACT,IAAI;YACJ,IAAI;QACR;IACJ;IACA,iBAAiB;QAAE,SAAS;QAAW,MAAM;IAAU;AAC3D;AASG,SAAS,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,OAAoB;IAC/E,MAAM,OAAY,UAAU,wKAAI,GAAG;IACnC,qBAAO,8OAAC;QAAK,WAAW,IAAA,kHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QAAM,GAAG,KAAK;;;;;;AACvF"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///Users/haradataishi/Culcept/app/drops/layout.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport { supabaseServer } from \"@/lib/supabase/server\";\nimport LogoutButton from \"@/app/components/LogoutButton\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default async function DropsLayout({ children }: { children: React.ReactNode }) {\n    const supabase = await supabaseServer();\n    const { data } = await supabase.auth.getUser();\n    const user = data.user;\n\n    return (\n        <div className=\"min-h-screen bg-white\">\n            <header className=\"sticky top-0 z-20 border-b border-zinc-200 bg-white/85 backdrop-blur\">\n                <div className=\"mx-auto flex max-w-5xl items-center justify-between px-4 py-3\">\n                    <div className=\"flex items-center gap-4\">\n                        <Link href=\"/drops\" className=\"text-lg font-extrabold tracking-tight no-underline\">\n                            Culcept\n                        </Link>\n                        <nav className=\"hidden items-center gap-3 text-sm font-semibold text-zinc-700 sm:flex\">\n                            <Link className=\"no-underline hover:text-zinc-950\" href=\"/drops\">\n                                Drops\n                            </Link>\n                            <Link className=\"no-underline hover:text-zinc-950\" href=\"/drops?mine=1\">\n                                My Drops\n                            </Link>\n                            <Link className=\"no-underline hover:text-zinc-950\" href=\"/drops/new\">\n                                New\n                            </Link>\n                        </nav>\n                    </div>\n\n                    <div className=\"flex items-center gap-3\">\n                        {user ? (\n                            <>\n                                <span className=\"hidden text-xs font-semibold text-zinc-600 md:inline\">{user.email}</span>\n                                <LogoutButton />\n                            </>\n                        ) : (\n                            <Button as-child=\"true\" variant=\"outline\">\n                                <Link className=\"no-underline\" href=\"/login?next=/drops\">\n                                    Login\n                                </Link>\n                            </Button>\n                        )}\n                    </div>\n                </div>\n            </header>\n\n            <main className=\"mx-auto max-w-5xl px-4 py-8\">{children}</main>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,eAAe,YAAY,EAAE,QAAQ,EAAiC;IACjF,MAAM,WAAW,MAAM,IAAA,2IAAc;IACrC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC5C,MAAM,OAAO,KAAK,IAAI;IAEtB,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAO,WAAU;0BACd,cAAA,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;;8CACX,8OAAC,0LAAI;oCAAC,MAAK;oCAAS,WAAU;8CAAqD;;;;;;8CAGnF,8OAAC;oCAAI,WAAU;;sDACX,8OAAC,0LAAI;4CAAC,WAAU;4CAAmC,MAAK;sDAAS;;;;;;sDAGjE,8OAAC,0LAAI;4CAAC,WAAU;4CAAmC,MAAK;sDAAgB;;;;;;sDAGxE,8OAAC,0LAAI;4CAAC,WAAU;4CAAmC,MAAK;sDAAa;;;;;;;;;;;;;;;;;;sCAM7E,8OAAC;4BAAI,WAAU;sCACV,qBACG;;kDACI,8OAAC;wCAAK,WAAU;kDAAwD,KAAK,KAAK;;;;;;kDAClF,8OAAC,6IAAY;;;;;;6DAGjB,8OAAC,qIAAM;gCAAC,YAAS;gCAAO,SAAQ;0CAC5B,cAAA,8OAAC,0LAAI;oCAAC,WAAU;oCAAe,MAAK;8CAAqB;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAS7E,8OAAC;gBAAK,WAAU;0BAA+B;;;;;;;;;;;;AAG3D"}}]
}